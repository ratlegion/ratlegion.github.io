<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ratlegion</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css" id="styletheme">

    <style>
        :root {
            --base-background-image: "";
            --base-background-color: #f4f4f4;
        }
    </style>

<body>
    <div style="display: flex; flex-direction: column;
    justify-content: space-between; min-height: 70vh">
        <div>
            <img src="assets/not_a_cult_1.png" style="max-width: 50%;">
        </div>
        <div>
            <div>
                <p id="info" style="text-shadow: 0px 0px 10px #FFFFFF; font-size: large;">
                    Step forth into the dark
                </p>
            </div>
            <button onclick="step()" id="stepButton">Take a step</button>
        </div>
    </div>

    <audio src="assets/footstep/1.ogg" id="footstep-1" preload></audio>
    <script type="module">
        const stepButton = document.getElementById("stepButton")
        const info = document.getElementById("info")
        let currentStep = 0;
        function step() {
            //stepButton.disabled = true;
            document.getElementById("footstep-1").play();

            currentStep++

            if (currentStep == 1) {
                info.innerText = "It is not immediately obvious when we have found new blood"

                document.body.style.backgroundColor = "#b5b5b5";
                playAudio()
            } else if (currentStep == 2) {
                info.innerText = "But for you-"

                document.body.style.backgroundColor = "#686e79";
                gainNode.gain.value = .1
                window.delayNodeGain.gain.value = 0.45;
            } else if (currentStep == 3) {
                info.innerText = "We knew it the second you clicked into this webpage"

                document.body.style.backgroundColor = "#353c49";
                gainNode.gain.value = .3
                window.delayNodeGain.gain.value = 0.4;
            } else if (currentStep == 4) {
                info.innerText = "Just a couple more steps..."

                document.body.style.backgroundColor = "#181926";
                gainNode.gain.value = .7
                window.delayNodeGain.gain.value = 0.3;
            } else if (currentStep == 5) {
                info.innerText = ""

                document.body.style.backgroundColor = "#000000";
                gainNode.gain.value = 1
                window.delayNodeGain.gain.value = 0.2;
            } else if (currentStep == 5) {
                info.innerText = ""

                gainNode.gain.value = 1.4
                window.delayNodeGain.gain.value = 0.1;
            }
        }
        // jank
        window.step = step;

        // https://jackyef.com/posts/building-an-audio-loop-player-on-the-web
        const audioCtx = new window.AudioContext();
        const source = audioCtx.createBufferSource();
        // window. allows you to modify via console
        window.gainNode = audioCtx.createGain();
        window.delayNode = audioCtx.createDelay();
        window.delayNodeGain = audioCtx.createGain();

        async function playAudio() {
            const arrayBuffer = await fetch("assets/the_dark_one.ogg").then((res) => res.arrayBuffer());
            const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);

            source.buffer = audioBuffer;
            source.loop = true;

            gainNode.gain.value = .1

            // echo
            window.delayNode.delayTime.value = 0.1
            window.delayNodeGain.gain.value = 0.5

            window.delayNode.connect(window.delayNodeGain);
            window.delayNodeGain.connect(window.delayNode);

            window.delayNode.connect(audioCtx.destination);

            window.gainNode.connect(window.delayNode);
            window.gainNode.connect(audioCtx.destination);

            source.connect(gainNode);

            source.start();
        }
        //when the user enters the area, it must begin.

        // document.addEventListener("click", playAudio, { once: true });
    </script>
</body>

</html>